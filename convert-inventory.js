const fs = require('fs');
const path = require('path');

console.log('\nðŸ”„ Converting your inventory data...\n');

// Read the inventory template (v2 with review workflow)
let inventoryData;
const templateFile = 'inventory-template-v2.json';
try {
    const rawData = fs.readFileSync(templateFile, 'utf8');
    inventoryData = JSON.parse(rawData);
    console.log(`âœ… Reading from: ${templateFile}\n`);
} catch (error) {
    console.error(`âŒ Error reading ${templateFile}`);
    console.error('Make sure the file exists and is valid JSON.');
    process.exit(1);
}

// Validate and convert items
const items = inventoryData.items.filter(item => {
    // Skip template/example items
    if (item.name.includes('[YOUR ITEM NAME HERE]')) {
        return false;
    }
    return true;
});

if (items.length === 0) {
    console.error('âŒ No valid items found!');
    console.error('Please fill in inventory-template.json with your real items.');
    process.exit(1);
}

console.log(`âœ… Found ${items.length} items to convert\n`);

// Convert to dashboard format (include all new fields)
const dashboardItems = items.map(item => {
    return {
        id: item.id,
        buildingId: item.buildingId,
        buildingName: item.buildingName,
        name: item.name,
        description: item.description,
        specifications: item.specifications,
        condition: item.condition,
        conditionRating: item.conditionRating,
        status: item.status,
        reviewStatus: item.reviewStatus,
        reviewedBy: item.reviewedBy,
        reviewDate: item.reviewDate,
        reviewNotes: item.reviewNotes,
        value: item.value,
        location: item.location,
        serialNumber: item.serialNumber,
        imageUrl: item.photoUrl || '/placeholder-equipment.jpg',
        photoUrl: item.photoUrl,
        aiAnalysis: item.aiAnalysis,
        notes: item.notes
    };
});

// Calculate totals for summary
const totalValue = dashboardItems.reduce((sum, item) => sum + item.value, 0);
const building1Count = dashboardItems.filter(i => i.buildingId === 'building-1').length;
const building2Count = dashboardItems.filter(i => i.buildingId === 'building-2').length;
const building3Count = dashboardItems.filter(i => i.buildingId === 'building-3').length;

// Generate TypeScript constants file
const tsContent = `// AUTO-GENERATED FROM inventory-template.json
// Last updated: ${new Date().toISOString()}
// DO NOT EDIT THIS FILE MANUALLY - Edit inventory-template.json instead

import { Building, InventoryItem } from './types';

export const BUILDINGS_DATA: Building[] = [
    {
        id: 'building-1',
        name: 'Building 1 - Silver',
        status: 'In Progress',
        path: 'M 150,50 L 150,200 L 350,200 L 350,50 Z',
    },
    {
        id: 'building-2',
        name: 'Building 2 - Green',
        status: 'In Progress',
        path: 'M 400,80 L 400,180 L 550,180 L 550,80 Z',
    },
    {
        id: 'building-3',
        name: 'Building 3 - Red',
        status: 'Pending',
        path: 'M 200,230 L 200,350 L 500,350 L 500,230 Z',
    },
];

export const INVENTORY_DATA: InventoryItem[] = ${JSON.stringify(dashboardItems, null, 4)};

// Statistics (for reference)
export const INVENTORY_STATS = {
    totalItems: ${dashboardItems.length},
    totalValue: ${totalValue},
    building1Items: ${building1Count},
    building2Items: ${building2Count},
    building3Items: ${building3Count},
    lastUpdated: '${new Date().toLocaleString()}'
};

// Status color mapping for UI
export const STATUS_COLORS = {
    'For Sale': 'bg-emerald-500/20 text-emerald-400 border-emerald-500',
    'Sold': 'bg-blue-500/20 text-blue-400 border-blue-500',
    'Pending Review': 'bg-yellow-500/20 text-yellow-400 border-yellow-500',
    'Reserved': 'bg-purple-500/20 text-purple-400 border-purple-500',
    'Scrap': 'bg-red-500/20 text-red-400 border-red-500',
    'In Progress': 'bg-orange-500/20 text-orange-400 border-orange-500',
    'Pending': 'bg-gray-500/20 text-gray-400 border-gray-500'
};

// Map status color mapping for PropertyMap component
export const MAP_STATUS_COLORS: Record<string, string> = {
    'In Progress': '#f97316', // Orange
    'Completed': '#10b981', // Green
    'Pending': '#6b7280', // Gray
    'For Sale': '#10b981', // Green
    'Sold': '#3b82f6', // Blue
    'Reserved': '#8b5cf6' // Purple
};
`;

// Write to constants.ts
const constantsPath = path.join('app', 'constants.ts');
try {
    fs.writeFileSync(constantsPath, tsContent);
    console.log('âœ… Successfully updated app/constants.ts\n');
} catch (error) {
    console.error('âŒ Error writing to app/constants.ts');
    console.error(error.message);
    process.exit(1);
}

// Print summary
console.log('ðŸ“Š Inventory Summary:\n');
console.log(`   Total Items: ${dashboardItems.length}`);
console.log(`   Total Value: $${totalValue.toLocaleString()}`);
console.log(`   Building 1 (Silver): ${building1Count} items`);
console.log(`   Building 2 (Green): ${building2Count} items`);
console.log(`   Building 3 (Red): ${building3Count} items`);
console.log('\nâœ… Ready to test! Run: cd app && npm run dev\n');

// Create a human-readable summary
const summaryContent = `# Inventory Data Summary

**Generated:** ${new Date().toLocaleString()}
**Total Items:** ${dashboardItems.length}
**Total Value:** $${totalValue.toLocaleString()}

## Items by Building

**Building 1 (Silver):** ${building1Count} items
${dashboardItems.filter(i => i.buildingId === 'building-1').map(i => `- ${i.name}: $${i.value.toLocaleString()}`).join('\n')}

**Building 2 (Green):** ${building2Count} items
${dashboardItems.filter(i => i.buildingId === 'building-2').map(i => `- ${i.name}: $${i.value.toLocaleString()}`).join('\n')}

**Building 3 (Red):** ${building3Count} items
${dashboardItems.filter(i => i.buildingId === 'building-3').map(i => `- ${i.name}: $${i.value.toLocaleString()}`).join('\n')}

## All Items

${dashboardItems.map((item, i) => `
### ${i + 1}. ${item.name}
- **Location:** ${item.location}
- **Condition:** ${item.condition}
- **Value:** $${item.value.toLocaleString()}
- **Description:** ${item.description}
${item.notes ? `- **Notes:** ${item.notes}` : ''}
`).join('\n')}
`;

fs.writeFileSync('inventory-summary.md', summaryContent);
console.log('ðŸ“„ Created inventory-summary.md for your reference\n');

console.log('ðŸŽ‰ All done! Next steps:\n');
console.log('1. cd app');
console.log('2. npm run dev');
console.log('3. Open http://localhost:5173');
console.log('4. Record your demo video!');
console.log('\n');
